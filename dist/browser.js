!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Type=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e,n){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function l(t){var r="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return c(t,arguments,d(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}function g(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],0<=e.indexOf(n)||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function b(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;m(this,n),this.message=t,this.validation=e}return i(n,[{key:"toString",value:function(){return"".concat(this.validation?"".concat(this.validation,": "):"").concat(this.message,".")}},{key:"exception",get:function(){return this.constructor.exception(this)}}],[{key:"for",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return t instanceof this?t:new this(t,e)}},{key:"exception",value:function(t){var e=new TypeError("".concat(t));return TypeError.captureStackTrace&&TypeError.captureStackTrace(e,TypeError),e}}]),n}(),p=function(t){function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return m(this,n),(t=b(this,d(n).call(this))).validation=e,t}return u(n,l(Array)),i(n,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){return e.push(h.for(t,e.validation))}),this}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){return e.splice(0,0,h.for(t,e.validation))}),this}},{key:"delegate",value:function(t){return this.length&&(t.delegated=!0,t.push.apply(t,f(this))),this}},{key:"toString",value:function(){return this.join("\n")}},{key:"empty",get:function(){return!this.length}},{key:"any",get:function(){return!!this.length}},{key:"exception",get:function(){return h.exception(this)}}]),n}();function n(t){return null===t?"null":"number"==typeof t&&isNaN(t)?"nan":Array.isArray(t)?"array":e(t)}function y(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(10<=i)return n(t);switch(n(t)){case"object":return"{".concat(Object.entries(t).map(function(t){var e=s(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(y(r,i+1))}).join(", "),"}");case"array":return"[".concat(t.map(function(t){return y(t,i+1)}).join(", "),"]");case"string":return"'".concat(t,"'");default:return"".concat(t)}}var t=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;m(this,n),this.annotations=[],this.type=t,this.value=e,this.errors=new p(this),this.canceled=!1}return i(n,[{key:"toString",value:function(){var t=this.type?"".concat(this.type," "):"",e=this.annotations.length?"[".concat(this.annotations.map(function(t){var e=s(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)}).join(", "),"] "):"";return"".concat(e).concat(this.state," ").concat(t,"value ").concat(y(this.value))}},{key:"annotate",value:function(t,e){return this.annotations.push([t,e]),this}},{key:"test",value:function(t){return this.type&&this.continue(this.type.constructor.tests[t]),this}},{key:"continue",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.canceled||this.failed||t.call.apply(t,[this,this].concat(n)),this}},{key:"cancel",value:function(){return this.canceled=!0,this}},{key:"throw",value:function(){if(this.failed)throw this.errors.exception}},{key:"delegate",value:function(t){return this.errors.delegate(t),this}},{key:"succeed",get:function(){return this.errors.empty}},{key:"failed",get:function(){return this.errors.any}},{key:"state",get:function(){return this.succeed?"Valid":"Invalid"}}]),n}(),v=function t(r){m(this,t);var e=new r,n=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return c(r,e)};return delete n.length,delete n.name,Object.setPrototypeOf(Object.defineProperties(n,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}({},Object.getOwnPropertyDescriptors(e),{toString:{value:function(){return e.toString()}}})),r.prototype)},x=function(){function n(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).optional,e=void 0!==t&&t;m(this,n),e&&(this.optional=!0)}return i(n,[{key:"validate",value:function(r){var i=this;return new t(this,r).continue(function(e){if(i.optional&&null==r)return e.cancel();var t=i.constructor.primitives,n=i.constructor.primitive(r);if(t.length&&!t.includes(n))return e.errors.add("primitive type must be ".concat(t.join(", "),", got ").concat(n));Object.keys(i.constructor.tests).forEach(function(t){t in i&&e.test(t)})})}},{key:"valid",value:function(t){return this.validate(t).succeed}},{key:"toString",value:function(){var t=Object.values(this).length?"(".concat(this.constructor.stringify(this).slice(1,-1),")"):"";return"".concat(this.constructor).concat(t)}}],[{key:"register",value:function(t){if("function"!=typeof t||!(t.prototype instanceof n))throw new TypeError("Can only register classes extending Type.");var e=t.toString();return this[e]=t,this[e[0].toLowerCase()+e.substring(1)]=new v(t),t}},{key:"toString",value:function(){var t=this.name.length-4,e=this.name;return this!==n&&"Type"===e.substring(t)?e.substring(0,t):e}}]),n}();o(x,"primitive",n),o(x,"stringify",y),o(x,"primitives",[]),o(x,"tests",{});var w=function(t){function n(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).optional,e=void 0===t||t;return m(this,n),b(this,d(n).call(this,{optional:e}))}return u(n,x),n}();o(w,"primitives",["nan","boolean","number","string","array","object","function"]);var j=function(t){function e(){return m(this,e),b(this,d(e).apply(this,arguments))}return u(e,x),e}();o(j,"primitives",["undefined"]);var O=function(t){function e(){return m(this,e),b(this,d(e).apply(this,arguments))}return u(e,x),e}();o(O,"primitives",["null"]);var k=function(t){function e(){return m(this,e),b(this,d(e).apply(this,arguments))}return u(e,x),e}();o(k,"primitives",["nan"]);var S=function(t){function e(){return m(this,e),b(this,d(e).apply(this,arguments))}return u(e,x),e}();o(S,"primitives",["boolean"]);var A=function(t){function p(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.integer,r=void 0!==n&&n,i=e.exclude,o=void 0!==i&&i,u=e.finite,a=void 0===u?null:u,c=e.minimum,l=void 0===c?null:c,s=e.maximum,f=void 0===s?null:s,h=g(e,["integer","exclude","finite","minimum","maximum"]);return m(this,p),t=b(this,d(p).call(this,h)),r&&(t.integer=!0),o&&(t.exclude=o),null!==a&&(t.finite=!!a),null!==l&&(t.minimum=l),null!==f&&(t.maximum=f),t}return u(p,x),i(p,[{key:"excludeMinimum",get:function(){return!0===this.exclude||this.exclude&&this.exclude.minimum}},{key:"excludeMaximum",get:function(){return!0===this.exclude||this.exclude&&this.exclude.maximum}}]),p}();o(A,"primitives",["number"]),o(A,"tests",{integer:function(t){var e=t.value,n=t.errors;Math.floor(e)!==e&&n.add("must be an integer")},finite:function(t){var e=t.value,n=t.errors,r=t.type.finite;r!==(e!==1/0&&e!==-1/0)&&n.add("must be ".concat(r?"":"in","finite"))},minimum:function(t){var e=t.value,n=t.errors,r=t.type,i=r.minimum,o=r.excludeMinimum;(e<i||e===i&&o)&&n.add("must be greater than".concat(o?"":" or equal to").concat(i))},maximum:function(t){var e=t.value,n=t.errors,r=t.type,i=r.maximum,o=r.excludeMaximum;(i<e||e===i&&o)&&n.add("must be lower than".concat(o?"":" or equal to"," ").concat(i))}});var T=function(t){function v(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.length,r=void 0===n?null:n,i=e.minimum,o=void 0===i?null:i,u=e.maximum,a=void 0===u?null:u,c=e.only,l=void 0===c?null:c,s=e.except,f=void 0===s?null:s,h=e.pattern,p=void 0===h?null:h,y=g(e,["length","minimum","maximum","only","except","pattern"]);return m(this,v),t=b(this,d(v).call(this,y)),null!==r&&(t.length=r),null!==o&&(t.minimum=o),null!==a&&(t.maximum=a),null!==l&&(t.only=l),null!==f&&(t.except=f),null!==p&&(t.pattern=p),t}return u(v,x),v}();o(T,"primitives",["string"]),o(T,"tests",{length:function(t){var e=t.value,n=t.errors,r=t.type.length;return e.length!==r&&n.add("length must be equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},minimum:function(t){var e=t.value,n=t.errors,r=t.type.minimum;return e.length<r&&n.add("length must be greater than or equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},maximum:function(t){var e=t.value,n=t.errors,r=t.type.maximum;return e.length>r&&n.add("length must be lower than or equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},only:function(t){var e=t.value,n=t.errors,r=t.type.only;e.split("").some(function(t){return!r.includes(t)})&&n.add("must only contain ".concat(r))},except:function(t){var e=t.value,n=t.errors,r=t.type.except;e.split("").some(function(t){return r.includes(t)})&&n.add("must not contain ".concat(r))},pattern:function(t){var e=t.value,n=t.errors,r=t.type.pattern;e.match(r)||n.add("must match pattern ".concat(r))}});var E=function(t){function s(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.length,i=void 0===r?null:r,o=n.minimum,u=void 0===o?null:o,a=n.maximum,c=void 0===a?null:a,l=g(n,["length","minimum","maximum"]);return m(this,s),t=b(this,d(s).call(this,l)),null!==e&&(t.structure=e),null!==i&&(t.length=i),null!==u&&(t.minimum=u),null!==c&&(t.maximum=c),t}return u(s,x),s}();o(E,"primitives",["array"]),o(E,"tests",{length:function(t){var e=t.value,n=t.errors,r=t.type.length;return e.length!==r&&n.add("length must be equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},minimum:function(t){var e=t.value,n=t.errors,r=t.type.minimum;return e.length<r&&n.add("length must be greater than or equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},maximum:function(t){var e=t.value,n=t.errors,r=t.type.maximum;return e.length>r&&n.add("length must be lower than or equal to ".concat(r,", ")+"got length equal to ".concat(e.length))},structure:function(t){var e=t.type.structure;t.test("structure".concat(Array.isArray(e)?"Array":"Type")),t.errors.delegated&&t.errors.prepend("structure is invalid")},structureArray:function(t){var n=t.value,r=t.errors;t.type.structure.some(function(t,e){return t.validate(n[e]).annotate("index",e).delegate(r).failed})},structureType:function(t){var e=t.value,n=t.errors,r=t.type.structure;e.some(function(t,e){return r.validate(t).annotate("index",e).delegate(n).failed})}});var P=function(t){function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return m(this,r),t=b(this,d(r).call(this,n)),null!==e&&(t.structure=e),t}return u(r,x),r}();o(P,"primitives",["object"]),o(P,"tests",{structure:function(t){var r=t.value,i=t.errors,e=t.type.structure;Object.entries(e).some(function(t){var e=s(t,2),n=e[0];return e[1].validate(r[n]).annotate("attribute",n).delegate(i).failed}),i.delegated&&i.prepend("structure is invalid")}});var q=function(t){function a(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.only,r=void 0===n?null:n,i=e.except,o=void 0===i?null:i,u=g(e,["only","except"]);return m(this,a),t=b(this,d(a).call(this,u)),r&&(t.only=Array.isArray(r)?r:[r]),o&&(t.except=Array.isArray(o)?o:[o]),t}return u(a,x),a}();o(q,"tests",{only:function(t){var e=t.value,n=t.errors,r=t.type.only;return!r.includes(e)&&n.add("must be ".concat(1<r.length?"one of ":"")+r.map(function(t){return x.stringify(t)}).join(", "))},except:function(t){var e=t.value,n=t.errors,r=t.type.except;return r.includes(e)&&n.add("must not be ".concat(1<r.length?"one of ":"")+r.map(function(t){return x.stringify(t)}).join(", "))}});var _=function(t){function i(){var t;m(this,i),t=b(this,d(i).call(this));for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.types=n,t}return u(i,x),i}();return o(_,"tests",{types:function(t){var e=t.value,n=t.errors,r=t.type.types,i=new p;r.every(function(t){return t.validate(e).delegate(i).failed})&&n.add.apply(n,["type must be one of ".concat(r.join(", "))].concat(f(i)))}}),x.register(w),x.register(j),x.register(O),x.register(k),x.register(S),x.register(A),x.register(T),x.register(E),x.register(P),x.register(q),x.register(_),x});
