!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Type=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e,n){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function s(t){var r="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return c(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}function n(t){return t&&t.__esModule?t:{default:t}}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;r(this,n),this.message=t,this.validation=e}return o(n,[{key:"toString",value:function(){return"".concat(this.validation?"".concat(this.validation,": "):"").concat(this.message,".")}},{key:"exception",get:function(){return this.constructor.exception(this)}}],[{key:"for",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return t instanceof this?t:new this(t,e)}},{key:"exception",value:function(t){var e=new TypeError("".concat(t));return TypeError.captureStackTrace&&TypeError.captureStackTrace(e,TypeError),e}}]),n}(),h=function(t){function n(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return r(this,n),(t=l(this,u(n).call(this))).validation=e,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(n,s(Array)),o(n,[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){return e.push(p.for(t,e.validation))}),this}},{key:"prepend",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){return e.splice(0,0,p.for(t,e.validation))}),this}},{key:"delegate",value:function(t){return this.length&&(t.delegated=!0,t.push.apply(t,y(this))),this}},{key:"toString",value:function(){return this.join("\n")}},{key:"empty",get:function(){return!this.length}},{key:"any",get:function(){return!!this.length}},{key:"exception",get:function(){return p.exception(this)}}]),n}(),v=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new d,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;r(this,n),this.type=t,this.value=e,this.errors=new h(this),this.annotations=[],this.canceled=!1,this.delegated=!1}return o(n,[{key:"toString",value:function(){var t=this.annotations.map(function(t){var e=f(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)}).join(", ");return t&&(t="[".concat(t,"] ")),"".concat(t).concat(this.state," ").concat(this.type," value ").concat(d.stringify(this.value))}},{key:"annotate",value:function(t,e){return this.annotations.push([t,e]),this}},{key:"test",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.continue.apply(this,[this.type.constructor.tests[t]].concat(n)),this}},{key:"continue",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.canceled||this.failed||t.call.apply(t,[this,this].concat(n)),this}},{key:"cancel",value:function(){return this.canceled=!0,this}},{key:"throw",value:function(){if(this.failed)throw this.errors.exception}},{key:"delegate",value:function(t){return this.errors.delegate(t),this}},{key:"succeed",get:function(){return this.errors.empty}},{key:"failed",get:function(){return this.errors.any}},{key:"state",get:function(){return this.succeed?"Valid":"Invalid"}}]),n}(),d=function(){function n(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).optional,e=void 0!==t&&t;r(this,n),e&&(this.optional=!0)}return o(n,[{key:"validate",value:function(r){var i=this;return new v(this,r).continue(function(e){if(i.optional&&null==r)return e.cancel();var t=i.constructor.primitives,n=i.constructor.primitive(r);if(t.length&&!t.includes(n))return e.errors.add("primitive type must be ".concat(t.join(", "),", got ").concat(n));Object.keys(i.constructor.tests).forEach(function(t){t in i&&e.test(t,i)})})}},{key:"valid",value:function(t){return this.validate(t).succeed}},{key:"toString",value:function(){var t=Object.values(this).length?"(".concat(this.constructor.stringify(this).slice(1,-1),")"):"";return"".concat(this.constructor).concat(t)}}],[{key:"register",value:function(t){if("function"!=typeof t||!(t.prototype instanceof n))throw new TypeError("Can only register classes extending Type.");var e=t.toString();return this.all.push(t),this[e]=t,this[e[0].toLowerCase()+e.substring(1)]=require("./generator").of(t),t}},{key:"primitive",value:function(t){return null===t?"null":"number"==typeof t&&isNaN(t)?"nan":Array.isArray(t)?"array":e(t)}},{key:"stringify",value:function(t){var i=this;switch(this.primitive(t)){case"object":return"{".concat(Object.entries(t).map(function(t){var e=f(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(i.stringify(r))}).join(", "),"}");case"array":return"[".concat(t.map(function(t){return i.stringify(t)}).join(", "),"]");case"string":return"'".concat(t,"'");default:return"".concat(t)}}},{key:"toString",value:function(){var t=this.name.length-4,e=this.name;return this!==n&&"Type"===e.substring(t)?e.substring(0,t):e}}]),n}();t(d,"primitives",[]),t(d,"tests",{}),t(d,"all",[]);var g={"any.js":n(require("./types/any.js")).default,"array.js":n(require("./types/array.js")).default,"boolean.js":n(require("./types/boolean.js")).default,"mixed.js":n(require("./types/mixed.js")).default,"nan.js":n(require("./types/nan.js")).default,"null.js":n(require("./types/null.js")).default,"number.js":n(require("./types/number.js")).default,"object.js":n(require("./types/object.js")).default,"string.js":n(require("./types/string.js")).default,"undefined.js":n(require("./types/undefined.js")).default,"value.js":n(require("./types/value.js")).default};return Object.values(g).forEach(function(t){return d.register(t)}),d});
